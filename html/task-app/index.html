<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Reminder</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
   
</head>
<body class="bg-gray-100 font-sans">

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Task Reminder</h1>

        <!-- Add Task Form -->
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="taskTitle">Task Title:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="taskTitle" type="text" placeholder="Enter task title">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="taskDateTime">Date & Time:</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="taskDateTime" type="datetime-local">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="uncompletedAfter">Uncompleted After:</label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="uncompletedAfter">
                    <option value="none">None</option>
                    <option value="1">1 Day</option>
                    <option value="2">2 Days</option>
                    <option value="3">3 Days</option>
                    <option value="4">4 Days</option>
                    <option value="5">5 Days</option>
                    <option value="6">6 Days</option>
                    <option value="7">7 Days</option>
                    <option value="8">8 Days</option>
                    <option value="9">9 Days</option>
                    <option value="10">10 Days</option>
                </select>
            </div>
            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" id="addTaskButton">Add Task</button>
        </div>

        <!-- Task List -->
        <h2 class="text-xl font-bold mb-2">Task List</h2>
        <div id="taskList">
            <!-- Tasks will be displayed here -->
        </div>
    </div>

   <script>
    document.addEventListener('DOMContentLoaded', () => {
    // --- Permissions ---
    requestPermissions();

    // --- Task Management ---
    const taskTitleInput = document.getElementById('taskTitle');
    const taskDateTimeInput = document.getElementById('taskDateTime');
    const uncompletedAfterSelect = document.getElementById('uncompletedAfter');
    const addTaskButton = document.getElementById('addTaskButton');
    const taskListDiv = document.getElementById('taskList');

    let tasks = loadTasks(); // Load tasks from localStorage

    displayTasks();  // Display tasks on page load

    addTaskButton.addEventListener('click', () => {
        const title = taskTitleInput.value;
        const dateTime = taskDateTimeInput.value;
        const uncompletedAfter = uncompletedAfterSelect.value;

        if (title && dateTime) {
            addTask(title, dateTime, uncompletedAfter);
            taskTitleInput.value = '';
            taskDateTimeInput.value = '';
            uncompletedAfterSelect.value = 'none';  // Reset to default
        } else {
            alert('Please enter both title and date/time.');
        }
    });

    // --- Functions ---

    function requestPermissions() {
        if (!("Notification" in window)) {
            alert("This browser does not support notifications.");
            return;
        }

        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                console.log("Notification permission granted.");
            } else if (permission === "denied") {
                console.log("Notification permission denied.");
            } else {
                console.log("Notification permission: default");
            }
        });
    }


    function addTask(title, dateTime, uncompletedAfter) {
        const task = {
            id: generateId(),  // Generate a unique ID for the task
            title: title,
            dateTime: dateTime,
            uncompletedAfter: uncompletedAfter,
            rescheduleCount: 0,
            rescheduleDateTime: null,
            completed: false
        };

        tasks.push(task);
        saveTasks();
        displayTasks();
        scheduleNotification(task); // Schedule the initial notification
    }

    function generateId() {
        return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    }

    function loadTasks() {
        const storedTasks = localStorage.getItem('tasks');
        return storedTasks ? JSON.parse(storedTasks) : [];
    }

    function saveTasks() {
        localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    function displayTasks() {
        taskListDiv.innerHTML = '';  // Clear the existing list

        tasks.forEach(task => {
            const taskDiv = document.createElement('div');
            taskDiv.classList.add('bg-white', 'shadow-md', 'rounded', 'p-4', 'mb-2');

            const uncompletedDays = calculateUncompletedDays(task.dateTime, task.uncompletedAfter);

            taskDiv.innerHTML = `
                <h3 class="text-lg font-semibold">${task.title}</h3>
                <p>Date & Time: ${formatDateTime(task.dateTime)}</p>
                <p>Reschedule Count: ${task.rescheduleCount}</p>
                <p>Reschedule Date & Time: ${task.rescheduleDateTime ? formatDateTime(task.rescheduleDateTime) : 'N/A'}</p>
                <p>Uncompleted Days: ${uncompletedDays !== null ? uncompletedDays : 'N/A'}</p>
                <button class="edit-button bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2" data-id="${task.id}">Edit</button>
                <button class="delete-button bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2" data-id="${task.id}">Delete</button>
                <button class="complete-button bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" data-id="${task.id}" ${task.completed ? 'disabled' : ''}>${task.completed ? 'Completed' : 'Complete'}</button>
            `;

            taskListDiv.appendChild(taskDiv);
        });

        // Add event listeners to the buttons *after* they are added to the DOM
        attachButtonListeners();
    }


    function attachButtonListeners() {
        document.querySelectorAll('.edit-button').forEach(button => {
            button.addEventListener('click', () => {
                const taskId = button.dataset.id;
                editTask(taskId);
            });
        });

        document.querySelectorAll('.delete-button').forEach(button => {
            button.addEventListener('click', () => {
                const taskId = button.dataset.id;
                deleteTask(taskId);
            });
        });

        document.querySelectorAll('.complete-button').forEach(button => {
            button.addEventListener('click', () => {
                const taskId = button.dataset.id;
                completeTask(taskId);
            });
        });
    }


    function editTask(taskId) {
        const taskIndex = tasks.findIndex(task => task.id === taskId);

        if (taskIndex === -1) {
            console.error('Task not found');
            return;
        }

        const task = tasks[taskIndex];

        // Populate the form with the task details
        taskTitleInput.value = task.title;
        taskDateTimeInput.value = task.dateTime;
        uncompletedAfterSelect.value = task.uncompletedAfter;

        // Change the "Add Task" button to an "Update Task" button
        addTaskButton.textContent = 'Update Task';
        addTaskButton.removeEventListener('click', addTaskButton.onclick); // Remove the old listener

        // Add a click listener to update the task
        addTaskButton.addEventListener('click', function updateTaskHandler() {
            const newTitle = taskTitleInput.value;
            const newDateTime = taskDateTimeInput.value;
            const newUncompletedAfter = uncompletedAfterSelect.value;

            if (newTitle && newDateTime) {
                // Update the task
                tasks[taskIndex].title = newTitle;
                tasks[taskIndex].dateTime = newDateTime;
                tasks[taskIndex].uncompletedAfter = newUncompletedAfter;

                saveTasks();
                displayTasks();

                // Revert the button back to "Add Task"
                addTaskButton.textContent = 'Add Task';
                addTaskButton.removeEventListener('click', updateTaskHandler); // Remove the update listener
                addTaskButton.addEventListener('click', () => { // Re-add the original add task listener
                    const title = taskTitleInput.value;
                    const dateTime = taskDateTimeInput.value;
                    const uncompletedAfter = uncompletedAfterSelect.value;

                    if (title && dateTime) {
                        addTask(title, dateTime, uncompletedAfter);
                        taskTitleInput.value = '';
                        taskDateTimeInput.value = '';
                        uncompletedAfterSelect.value = 'none';  // Reset to default
                    } else {
                        alert('Please enter both title and date/time.');
                    }
                });

                // Clear the form
                taskTitleInput.value = '';
                taskDateTimeInput.value = '';
                uncompletedAfterSelect.value = 'none';
            } else {
                alert('Please enter both title and date/time.');
            }
        });
    }


    function deleteTask(taskId) {
        tasks = tasks.filter(task => task.id !== taskId);
        saveTasks();
        displayTasks();
    }

    function completeTask(taskId) {
        const taskIndex = tasks.findIndex(task => task.id === taskId);
        if (taskIndex !== -1) {
            tasks[taskIndex].completed = true;
            saveTasks();
            displayTasks();
        }
    }

    function calculateUncompletedDays(dateTime, uncompletedAfter) {
        if (uncompletedAfter === 'none') {
            return null;  // Or some other indicator that it's not applicable
        }

        const taskDueDate = new Date(dateTime);
        const now = new Date();
        const diffInMs = now.getTime() - taskDueDate.getTime();
        const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));

        if (diffInDays > parseInt(uncompletedAfter)) {
            return diffInDays;
        } else {
            return 0; // Or some other indicator that it's not uncompleted yet
        }
    }


    function formatDateTime(dateTimeString) {
        const date = new Date(dateTimeString);
        return date.toLocaleString(); // You can customize the format as needed
    }

    function scheduleNotification(task) {
        const taskDateTime = new Date(task.dateTime).getTime();
        const now = Date.now();
        const delay = taskDateTime - now;

        if (delay > 0) {
            setTimeout(() => {
                showNotification(task.title);
            }, delay);
        }
    }


    function showNotification(title) {
        if (Notification.permission === "granted") {
            new Notification("Task Reminder", {
                body: title,
                icon: 'icon.png' // Replace with your icon path
            });
        } else if (Notification.permission !== "denied") {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    new Notification("Task Reminder", {
                        body: title,
                        icon: 'icon.png'  // Replace with your icon path
                    });
                }
            });
        }
    }


});
   </script>
</body>
</html>